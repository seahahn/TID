# 20220902

1. AWS EC2 Auto Scaling Group 적용하기

- 부하 테스트를 통해 API 서버의 한계치를 측정했음(EC2 instance 1개)
- 기준(1분간 초당 500명의 사용자 요청 pass)에 미치지 못했기에 auto scaling을 통해 한계치를 늘려보고자 함
- Auto Scaling Group 설정을 하기에 앞서 몇 가지 우선적으로 수행해야 할 과정이 있었음
  - API 서버 이미지 만들기
    - EC2 - 좌측 인스턴스 - 인스턴스 클릭
    - 여기서 Auto Scaling Group으로 만들 기존의 EC2 instance를 선택
    - 우상단 작업 - 이미지 및 템플릿 - 이미지 생성 클릭
    - 이미지 이름, 인스턴스 볼륨 등을 설정 후 우하단 이미지 생성 클릭
    - 이후 좌측 이미지 - AMI 에서 생성한 이미지가 사용 가능 상태가 되는 것을 확인하면 이미지 생성 완료
  - 시작 템플릿 만들기
    - 서버 이미지 생성 후 이를 포함한 시작 템플릿을 생성해야 함
    - EC2 - 좌측 인스턴스 - 인스턴스 클릭
      - 시작 템플릿을 눌러서 시작 템플릿 생성을 해도 됨
      - 다만 인스턴스 선택을 통해 진행하는 이유는 해당 인스턴스의 설정(인스턴스 유형 등)을 그대로 가져와서 편리하기 때문임
    - 여기서 Auto Scaling Group으로 만들 기존의 EC2 instance를 선택
    - 우상단 작업 - 이미지 및 템플릿 - 인스턴스에서 템플릿 생성 클릭
    - 시작 템플릿 이름, 설명, Auto Scaling 지침에 체크
    - 애플리케이셔너 및 OS 이미지(AMI)에서 내 AMI 선택 - 내 소유 - 이전에 생성한 이미지를 선택
    - 인스턴스 유형은 선택했던 인스턴스 유형이 그대로 들어가 있음(원할 경우 변경 가능)
    - 키 페어, 네트워크 설정도 선택헀던 인스턴스의 설정이 그대로 들어옴
      - 여기서 서브넷은 시작 템플릿에 포함하지 않음을 선택(이후 instance 생성 시 자동으로 지정됨)
    - 이후 시작 템플릿 생성 클릭
      - 클릭을 하면 Auto Scaling Group에는 적용할 수 없는 옵션에 대한 안내가 나오니 해당 부분은 시작 템플릿에 포함하지 않음 선택하기
  - 이미지 생성 테스트
    - AMI에 등록된 이미지를 이용하여 EC2 instance를 시작할 수 있음
    - 이를 통해 이미지가 의도한 대로 등록되었는지, 그리고 instance는 정상적으로 생성 및 작동하는지 알 수 있음
    - 참고: docker container를 이용하여 서버를 실행 중인 경우 log가 쌓이는데, 이것까지 통째로 이미지에 포함되어 있음. 불필요하면 이를 초기화 후 이미지 생성할 것.
  - Auto Scaling Group 생성
    - EC2 - 좌측 Auto Scaling - Auto Scaling 그룹 클릭
    - Auto Scaling 그룹 생성 클릭 후 그룹 이름과 위에서 생성한 시작 템플릿을 선택(템플릿 선택 후 사용할 버전 선택하기) 그리고 다음
    - 네트워크에서 서브넷 선택 후 다음
    - 여기서는 로드 밸런서 없음 체크 후 다음
    - 그룹 크기에서 원하는 용량, 최소/최대 용량 지정하기(0으로 지정하면 아예 다 꺼버린다는 의미이므로 주의)
    - 크기 조정 정책은 설정하고 싶으면 대상 추적 크기 조정 정책 선택 후 정책 이름과 지표, 값 입력하기
    - 이후 알림 및 태그는 개인 선택에 따라 설정하기
    - 마지막 검토 화면 하단에서 Auto Scaling 그룹 생성 클릭하면 생성 완료
    - Auto Scaling 그룹이 생성되면 자동으로 그룹 크기에서 지정한 원하는 용량만큼 EC2 instance가 생성됨
      - 만약 처음에 원하는 용량을 2로 지정 후 시작하면 instance가 2개 생성됨
      - 여기서 Auto Scaling 그룹 설정의 원하는 용량을 1로 변경하면 자동으로 2개 중 하나가 종료됨

<참고 자료>

- [Amazon EC2 Auto Scaling 시작하기 - AWS Docs](https://docs.aws.amazon.com/ko_kr/autoscaling/ec2/userguide/get-started-with-ec2-auto-scaling.html)
- [[AWS] 📚 Auto Scaling 개념 원리 & 사용 세팅 💯 정리](https://inpa.tistory.com/entry/AWS-%F0%9F%93%9A-EC2-%EC%98%A4%ED%86%A0-%EC%8A%A4%EC%BC%80%EC%9D%BC%EB%A7%81-ELB-%EB%A1%9C%EB%93%9C-%EB%B0%B8%EB%9F%B0%EC%84%9C-%EA%B0%9C%EB%85%90-%EA%B5%AC%EC%B6%95-%EC%84%B8%ED%8C%85-%F0%9F%92%AF-%EC%A0%95%EB%A6%AC)
