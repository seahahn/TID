# 20220601

1. ChartJS - Doughnut Chart 아이템 클릭 시 옆 아이템 선택되는 문제

- 도넛 차트에 표시된 아이템을 클릭 시 해당되는 데이터 수치를 우측에 보여주는 기능이 있음
- 그런데 도넛 차트 클릭할 때 가장자리 부근을 클릭하면 마우스 오버된 아이템이 아닌 옆 아이템이 클릭되는 문제가 있었음
- 로그에도 선택된 아이템의 인덱스가 해당 아이템이 아닌 옆 아이템 인덱스로 출력이 되는 것을 확인하였음
- 마우스가 가리키는 위치와 도넛 차트 아이템이 잘못 선택되는 것이 관련이 있을 것이라고 가정하여 문제 해결 방법을 찾아봄
- 기존에 도넛 차트 아이템 클릭 시 해당 아이템 인덱스를 가져오는 코드는 아래와 같았음

```tsx
// 불필요한 내용 생략
const options = useCallback(() => {
  return {
    // ...
    onClick: (e: any) => {
      consolelog("onClick", e);
      const click = e.native;
      const myChart = e.chart;
      const points = myChart.getElementsAtEventForMode(click, "nearest", { intersect: false }, true);

      if (points.length) {
        const index = points[0].index;
        dispatch(setSelectedDataIndex(index)); // 선택된 데이터의 인덱스값 저장
      }
    },
    // ...
  };
}, []);
```

- 위 코드를 다시 살펴보던 중 'nearest'라는 키워드가 눈에 들어왔고, 이를 중심으로 구글링 진행함
  - nearest, 말 그대로 가장 가깝다는 것인데, 지금의 경우는 가장 가까운게 아니라 '정확히' 해당 지점을 가리켜야 했음
- 그 결과 'nearest' 자리에 들어갈 수 있는 여러 가지 옵션이 있었고, 그 중 정확한 지점을 가리키게 만드는 'point'로 옵션값을 변경함
- 결과 의도한 대로 옆 아이템 선택되는 에러 없이 정상 작동함

<참고 자료>

- [.getElementsAtEventForMode(e, mode, options, useFinalPosition) - Chart.js 3.7.1](https://www.chartjs.org/docs/3.7.1/developers/api.html#getelementsateventformode-e-mode-options-usefinalposition)
- [Interactions-Modes - Chart.js 3.7.1](https://www.chartjs.org/docs/3.7.1/configuration/interactions.html#modes)

---

2.
