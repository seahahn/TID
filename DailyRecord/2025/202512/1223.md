# 20251223

## 1. tanstack query 사용 시 staleTime 설정 주의사항 - SolidJS 기준 (경험에 근거)

tanstack query의 useQuery를 보면 staleTime 옵션이 있음. 이는 일정 시간마다 해당 쿼리의 데이터를 (말하자면) 리프레쉬하여 최신 데이터로 불러오게끔 하는 것이다.
문제는 이를 별 생각없이 (특히 전역 queryClient에) 설정해놓으면 때때로 특정한 컴포넌트들에서 부작용이 발생할 수 있다.
내가 경험한 대표적인 예시로는 useQuery를 통해 리스트 형식의 데이터를 불러와 <For> 컴포넌트를 사용하여 랜더링할 경우, staleTime 시간이 될 때마다 이 컴포넌트의 스크롤이 초기화되는 문제가 있었다.

즉,

1. staleTime이 다 되어서 useQuery는 (데이터가 최신 상태와 동일한지 아닌지 상관없이) 일단 데이터 쿼리를 수행했고,
2. 쿼리된 데이터는 기존 데이터와 참조가 다르기에 <For> 컴포넌트는 이를 새로운 데이터로 인식했고,
3. 그 결과 랜더링된 리스트 자체가 다시 랜더링이 되어 기존에 사용자가 해당 컴포넌트에서 위치시키고 있던 스크롤 등이 초기화된 것이다.

(스크롤 초기화라는건 그냥 쉽게 말하면 스크롤이 마치 스크린의 맨 위로 지멋대로 돌아간 것과 같은 현상을 말함)

아무튼, staleTime 옵션이 멋대로 붙어있지는 않은지 useQuery를 사용할 때나 app.tsx와 같은 root 파일에서 전역으로 주입되는 queryClient를 설정할 때나 잘 확인하도록 하자!