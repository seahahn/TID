# 20250909

## 1. Minio Client 초기화 시 주의할 점

로컬호스트에서는 잘 되던 minio가 클러스터에 배포하고 나니 아래와 같이 초기화 하면 timeout error가 발생했다.

```ts
export const MinioService = {
  endPoint: process.env.MINIO_ENDPOINT || "localhost",
  port: Number(process.env.MINIO_API_PORT || "9000"), // ! When MINIO_USE_SSL is true, this should be 443
  useSSL: process.env.MINIO_USE_SSL === "true",
  accessKey: process.env.MINIO_ACCESS_KEY,
  secretKey: process.env.MINIO_SECRET_KEY,
  url: process.env.MINIO_URL || "http://localhost:9000",
}

const client = new Client(MinioService)

const id = v4()
const bucket = "uploads"
const url = await client.presignedPutObject(bucket, `tmp/${id}`) // 문제 발생 지점 - timeout error
```

timeout error를 보면 대강 아래처럼 클러스터 내부 IP와 함께 port 9000을 갖고 연결을 하는 것에 문제가 있는 것으로 나왔음

e.g. 142.168.1.1:9000

배포된 minio의 endpoint는 ingress에 의해서 https가 적용되어 있었고, 그렇기에 USE_SSL의 값을 true로 설정했음.
하지만 port는 9000으로 했었는데, 이를 443으로 변경하는 것이 맞다는 가설을 세웠음.
이를 알게 된 것은 npm minio에서 port에 대한 설명때문이었음.

- port: TCP/IP port number. Optional, defaults to 80 for HTTP and 443 for HTTPs.

적용 결과, 클러스터에 배포된 minio가 로컬호스트에서와 같이 정상 작동함.

<참고 자료>

- [minio - npm](https://www.npmjs.com/package/minio)
