# 20250722

## 1. Gitlab CI/CD pipeline에서 posthog가 초기화되지 않아 생기는 이슈 해결

- posthog를 사용하여 feature flag를 앱에 적용하고자 했음.
- 코드 상에서는 아무 문제가 없었고, 로컬 환경에서 작동도 정상적으로 되었음.
- 허나, gitlab ci/cd test pipeline에서 아래 에러가 나오며 테스트 자체가 진행되질 못함
  - TypeError: posthog.isFeatureEnabled is not a function
- 원인을 알아보니, ci/cd는 headless 모드로 작동하므로 posthog init가 되질 않은 것임
- 테스트를 수행하는데에 feature flag 존재 유무는 중요치 않았으므로, 아래와 같은 wrapper function을 만들어 적용함

```
import { ENV_SLUG } from "environment"
import posthog from "posthog-js"

export const isFeatureFlagEnabled = (
  flagName: string,
  defaultValue = false,
): boolean => {
  if (["local", "test"].includes(ENV_SLUG)) return true
  if (typeof window === "undefined") return defaultValue
  if (!posthog.isFeatureEnabled) return defaultValue
  return !!posthog.isFeatureEnabled(flagName)
}
```